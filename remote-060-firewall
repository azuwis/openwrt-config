oc_uci_batch_set "$config_firewall"
oc_uci_del_type firewall redirect
firewall_redirect() {
    local proto src_dport dest_ip dest_port
    while read proto src_dport dest_ip dest_port
    do
        uci add firewall redirect >/dev/null
        uci set "firewall.@redirect[-1].target=DNAT"
        uci set "firewall.@redirect[-1].src=wan"
        uci set "firewall.@redirect[-1].dest=lan"
        uci set "firewall.@redirect[-1].proto=$proto"
        uci set "firewall.@redirect[-1].src_dport=$src_dport"
        set +u
        if [ x"$dest_ip" != x'-' -a x"$dest_ip" != x ]; then
            uci set "firewall.@redirect[-1].dest_ip=$dest_ip"
        fi
        if [ x"$dest_port" != x ]; then
            uci set "firewall.@redirect[-1].dest_port=$dest_port"
        fi
        set -u
    done
}
echo "$config_redirect" | oc_strip_comment | firewall_redirect
oc_service reload firewall 2>/dev/null
