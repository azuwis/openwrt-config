opkg remove wpad-mini >/dev/null
opkg_install wpad

# https://dev.openwrt.org/ticket/19175
if grep -q uci_get_state /lib/netifd/hostapd.sh && \
        ! grep -qxF '. /lib/config/uci.sh' /lib/netifd/hostapd.sh
then
    echo 'patch /lib/netifd/hostapd.sh'
    sed -i '1s#^#. /lib/config/uci.sh\n#' /lib/netifd/hostapd.sh
fi

if uci_exists wireless.@wifi-iface[0]; then
    uci set wireless.@wifi-iface[0].iapp_interface=lan
    uci set wireless.@wifi-iface[0].rsn_preauth=1
fi
service reload network wireless
